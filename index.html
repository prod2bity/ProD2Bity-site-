<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Chat GPT com OpenAI</title>
<style>
  body { font-family: Arial; background:#121212; color:#eee; margin:0; height:100vh; display:flex; flex-direction:column; }
  #chat { flex:1; overflow-y:auto; padding:1rem; background:#222; }
  .msg { margin-bottom:1rem; max-width:80%; padding:0.7rem 1rem; border-radius:15px; }
  .user { background:#1e88e5; margin-left:auto; text-align:right; }
  .bot { background:#424242; margin-right:auto; text-align:left; }
  #input-area { display:flex; padding:0.5rem; background:#333; }
  #input-text { flex:1; padding:0.7rem; border:none; border-radius:20px; font-size:1rem; outline:none; }
  #send-btn { margin-left:0.5rem; padding:0 1rem; border:none; border-radius:20px; background:#1e88e5; color:#fff; font-weight:bold; cursor:pointer; }
  #send-btn:hover { background:#1565c0; }
</style>
</head>
<body>

<div id="chat"></div>
<div id="input-area">
  <input type="text" id="input-text" placeholder="Digite sua mensagem..." autocomplete="off" />
  <button id="send-btn">Enviar</button>
</div>

<script>
  const chat = document.getElementById("chat");
  const inputText = document.getElementById("input-text");
  const sendBtn = document.getElementById("send-btn");

  const messages = [
    { role: "system", content: "Você é um assistente amigável." }
  ];

  function addMessage(text, sender) {
    const div = document.createElement("div");
    div.classList.add("msg", sender);
    div.textContent = text;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
  }

  async function sendMessage() {
    const msg = inputText.value.trim();
    if (!msg) return;
    addMessage(msg, "user");
    messages.push({ role: "user", content: msg });
    inputText.value = "";
    
    addMessage("...", "bot"); // indicador de carregamento
    chat.lastChild.scrollIntoView();

    try {
      const response = await fetch("/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ messages }),
      });
      const data = await response.json();
      chat.removeChild(chat.lastChild); // remove "..."
      addMessage(data.reply, "bot");
      messages.push({ role: "assistant", content: data.reply });
    } catch (error) {
      chat.removeChild(chat.lastChild);
      addMessage("Erro ao conectar com a IA.", "bot");
      console.error(error);
    }
  }

  sendBtn.addEventListener("click", sendMessage);
  inputText.addEventListener("keypress", e => {
    if (e.key === "Enter") sendMessage();
  });
</script>

</body>
</html>
