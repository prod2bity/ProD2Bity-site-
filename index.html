<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mini Clash Royale</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #87ceeb;
    margin: 0; padding: 0;
    overflow-x: hidden;
  }
  #game {
    position: relative;
    width: 100vw;
    height: 300px;
    background: #c2f0c2;
    border: 3px solid #444;
    margin: 20px auto;
    max-width: 600px;
    overflow: hidden;
  }
  .castle {
    position: absolute;
    top: 50px;
    width: 60px;
    height: 150px;
    background: #8b4513;
    border: 3px solid #000;
    box-sizing: border-box;
  }
  #castle-player {
    left: 10px;
  }
  #castle-enemy {
    right: 10px;
  }
  .health-bar {
    position: absolute;
    height: 10px;
    background: #0f0;
    top: 10px;
    border: 1px solid #000;
  }
  #health-player {
    left: 10px;
    width: 100px;
  }
  #health-enemy {
    right: 10px;
    width: 100px;
  }
  .troop {
    position: absolute;
    bottom: 50px;
    width: 30px;
    height: 40px;
    background: red;
    border: 2px solid #800;
    border-radius: 5px;
  }
  .troop.enemy {
    background: blue;
    border-color: #008;
  }
  #btn-spawn {
    display: block;
    margin: 10px auto;
    padding: 10px 20px;
    font-size: 18px;
    cursor: pointer;
  }
  #status {
    text-align: center;
    font-weight: bold;
    font-size: 20px;
    margin-top: 10px;
  }
</style>
</head>
<body>

<div id="game">
  <div id="castle-player" class="castle"></div>
  <div id="castle-enemy" class="castle"></div>

  <div id="health-player" class="health-bar"></div>
  <div id="health-enemy" class="health-bar"></div>
</div>

<button id="btn-spawn">Lançar Tropa</button>
<div id="status"></div>

<script>
  const game = document.getElementById('game');
  const healthPlayer = document.getElementById('health-player');
  const healthEnemy = document.getElementById('health-enemy');
  const btnSpawn = document.getElementById('btn-spawn');
  const status = document.getElementById('status');

  let playerHealth = 100;
  let enemyHealth = 100;

  const troops = []; // armazena tropas

  // Configurações
  const troopSpeed = 1; // px por frame
  const troopDamage = 10;
  const spawnCooldown = 2000; // 2s entre tropas inimigas

  // Criar tropa
  function createTroop(side) {
    const troop = document.createElement('div');
    troop.classList.add('troop');
    if (side === 'enemy') troop.classList.add('enemy');
    troop.health = 30;
    troop.side = side;
    troop.speed = side === 'player' ? troopSpeed : -troopSpeed;
    troop.x = side === 'player' ? 80 : game.clientWidth - 80;
    troop.style.bottom = '50px';
    troop.style.left = troop.x + 'px';
    game.appendChild(troop);
    troops.push(troop);
  }

  // Atualizar posição tropas e resolver batalhas
  function update() {
    for (let i = troops.length -1; i >= 0; i--) {
      const t = troops[i];
      t.x += t.speed;
      t.style.left = t.x + 'px';

      // Verificar colisão com castelo adversário
      if (t.side === 'player' && t.x + 30 >= game.clientWidth - 70) {
        enemyHealth -= troopDamage;
        updateHealth();
        removeTroop(i);
        continue;
      }
      if (t.side === 'enemy' && t.x <= 70) {
        playerHealth -= troopDamage;
        updateHealth();
        removeTroop(i);
        continue;
      }

      // Verificar colisão com tropas inimigas
      for (let j = 0; j < troops.length; j++) {
        if (i === j) continue;
        const other = troops[j];
        if (t.side !== other.side) {
          if (Math.abs(t.x - other.x) < 30) {
            // Trocas de dano
            t.health -= 1;
            other.health -= 1;
            if (t.health <= 0) removeTroop(i);
            if (other.health <= 0) removeTroop(j);
            break;
          }
        }
      }
    }

    checkGameOver();
    requestAnimationFrame(update);
  }

  // Remover tropa
  function removeTroop(index) {
    if (index < 0 || index >= troops.length) return;
    const t = troops[index];
    if (t.parentNode) t.parentNode.removeChild(t);
    troops.splice(index, 1);
  }

  // Atualizar barras de vida
  function updateHealth() {
    healthPlayer.style.width = playerHealth + 'px';
    healthEnemy.style.width = enemyHealth + 'px';

    if (playerHealth < 30) healthPlayer.style.background = '#f00';
    else healthPlayer.style.background = '#0f0';

    if (enemyHealth < 30) healthEnemy.style.background = '#f00';
    else healthEnemy.style.background = '#0f0';
  }

  // Inimigo lança tropas automático
  setInterval(() => {
    if (playerHealth <= 0 || enemyHealth <= 0) return;
    createTroop('enemy');
  }, spawnCooldown);

  btnSpawn.addEventListener('click', () => {
    if (playerHealth <= 0 || enemyHealth <= 0) return;
    createTroop('player');
  });

  function checkGameOver() {
    if (playerHealth <= 0) {
      status.textContent = "Você perdeu!";
      stopGame();
    } else if (enemyHealth <= 0) {
      status.textContent = "Você venceu!";
      stopGame();
    }
  }

  function stopGame() {
    btnSpawn.disabled = true;
  }

  // Iniciar saúde e barras
  updateHealth();
  // Começar loop de update
  requestAnimationFrame(update);
</script>

</body>
</html>
